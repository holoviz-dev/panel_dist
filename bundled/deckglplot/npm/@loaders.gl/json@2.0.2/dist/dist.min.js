!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(window,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){(function(e){const i=s(2),n="undefined"==typeof window?e:window;n.loaders=n.loaders||{},t.exports=Object.assign(n.loaders,i)}).call(this,s(1))},function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(t){"object"==typeof window&&(s=window)}t.exports=s},function(t,e,s){"use strict";s.r(e);const i=100;class n{constructor(t,e,s=i){this.TableBatchType=t,this.schema=e,this.batchSize=s,this.batch=null,this.batchCount=0}addRow(t){if(!this.batch){const{TableBatchType:t}=this;this.batch=new t(this.schema,this.batchSize)}this.batch.addRow(t)}chunkComplete(){this.batch&&this.batch.chunkComplete()}isFull(){return this.batch&&this.batch.isFull()}hasBatch(){return Boolean(this.batch)}getNormalizedBatch(){if(this.batch){const t=this.batch.getNormalizedBatch();return this.batch=null,t.count=this.batchCount,this.batchCount++,t}return null}}const o=Number.MAX_SAFE_INTEGER,r="debug"==={}.CDEBUG,a={textNode:void 0,numberNode:""};let h=0;const c={BEGIN:h++,VALUE:h++,OPEN_OBJECT:h++,CLOSE_OBJECT:h++,OPEN_ARRAY:h++,CLOSE_ARRAY:h++,TEXT_ESCAPE:h++,STRING:h++,BACKSLASH:h++,END:h++,OPEN_KEY:h++,CLOSE_KEY:h++,TRUE:h++,TRUE2:h++,TRUE3:h++,FALSE:h++,FALSE2:h++,FALSE3:h++,FALSE4:h++,NULL:h++,NULL2:h++,NULL3:h++,NUMBER_DECIMAL_POINT:h++,NUMBER_DIGIT:h++};for(var u in c)c[c[u]]=u;h=c;const l={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125};var d=/[\\"\n]/g;class p{constructor(t={}){this._initialize(t)}_initialize(t){this._clearBuffers(this),this.bufferCheckPosition=o,this.q="",this.c="",this.p="",this.options=t||{},this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.tag=null,this.error=null,this.state=h.BEGIN,this.stack=new Array,this.position=this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,"onready"in t&&(this.onready=t.onready),"onopenobject"in t&&(this.onopenobject=t.onopenobject),"onkey"in t&&(this.onkey=t.onkey),"oncloseobject"in t&&(this.oncloseobject=t.oncloseobject),"onopenarray"in t&&(this.onopenarray=t.onopenarray),"onclosearray"in t&&(this.onclosearray=t.onclosearray),"onvalue"in t&&(this.onvalue=t.onvalue),"onerror"in t&&(this.onerror=t.onerror),"onend"in t&&(this.onend=t.onend),"onchunkparsed"in t&&(this.onchunkparsed=t.onchunkparsed),f(this,"onready")}_clearBuffers(){for(var t in a)this[t]=a[t]}end(){return this.state===h.VALUE&&0===this.depth||S(this,"Unexpected end"),E(this),this.c="",this.closed=!0,f(this,"onend"),this._initialize(this.options),this}resume(){return this.error=null,this}close(){return this.write(null)}write(t){if(this.error)throw this.error;if(this.closed)return S(this,"Cannot write after close. Assign an onready handler.");if(null===t)return this.end();var e=0,s=t.charCodeAt(0),i=this.p;for(r&&console.log("write -> ["+t+"]");s&&(i=s,this.c=s=t.charCodeAt(e++),i!==s?this.p=i:i=this.p,s);)switch(r&&console.log(e,s,c[this.state]),this.position++,s===l.lineFeed?(this.line++,this.column=0):this.column++,this.state){case h.BEGIN:s===l.openBrace?this.state=h.OPEN_OBJECT:s===l.openBracket?this.state=h.OPEN_ARRAY:y(s)||S(this,"Non-whitespace before {[.");continue;case h.OPEN_KEY:case h.OPEN_OBJECT:if(y(s))continue;if(this.state===h.OPEN_KEY)this.stack.push(h.CLOSE_KEY);else{if(s===l.closeBrace){f(this,"onopenobject"),this.depth++,f(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||h.VALUE;continue}this.stack.push(h.CLOSE_OBJECT)}s===l.doubleQuote?this.state=h.STRING:S(this,'Malformed object key should start with "');continue;case h.CLOSE_KEY:case h.CLOSE_OBJECT:if(y(s))continue;this.state,h.CLOSE_KEY;s===l.colon?(this.state===h.CLOSE_OBJECT?(this.stack.push(h.CLOSE_OBJECT),E(this,"onopenobject"),this.depth++):E(this,"onkey"),this.state=h.VALUE):s===l.closeBrace?(b(this,"oncloseobject"),this.depth--,this.state=this.stack.pop()||h.VALUE):s===l.comma?(this.state===h.CLOSE_OBJECT&&this.stack.push(h.CLOSE_OBJECT),E(this),this.state=h.OPEN_KEY):S(this,"Bad object");continue;case h.OPEN_ARRAY:case h.VALUE:if(y(s))continue;if(this.state===h.OPEN_ARRAY){if(f(this,"onopenarray"),this.depth++,this.state=h.VALUE,s===l.closeBracket){f(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||h.VALUE;continue}this.stack.push(h.CLOSE_ARRAY)}s===l.doubleQuote?this.state=h.STRING:s===l.openBrace?this.state=h.OPEN_OBJECT:s===l.openBracket?this.state=h.OPEN_ARRAY:s===l.t?this.state=h.TRUE:s===l.f?this.state=h.FALSE:s===l.n?this.state=h.NULL:s===l.minus?this.numberNode+="-":l._0<=s&&s<=l._9?(this.numberNode+=String.fromCharCode(s),this.state=h.NUMBER_DIGIT):S(this,"Bad value");continue;case h.CLOSE_ARRAY:if(s===l.comma)this.stack.push(h.CLOSE_ARRAY),E(this,"onvalue"),this.state=h.VALUE;else if(s===l.closeBracket)b(this,"onclosearray"),this.depth--,this.state=this.stack.pop()||h.VALUE;else{if(y(s))continue;S(this,"Bad array")}continue;case h.STRING:void 0===this.textNode&&(this.textNode="");var n=e-1,u=this.slashed,p=this.unicodeI;t:for(;;){for(r&&console.log(e,s,c[this.state],u);p>0;)if(this.unicodeS+=String.fromCharCode(s),s=t.charCodeAt(e++),this.position++,4===p?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),p=0,n=e-1):p++,!s)break t;if(s===l.doubleQuote&&!u){this.state=this.stack.pop()||h.VALUE,this.textNode+=t.substring(n,e-1),this.position+=e-1-n;break}if(s===l.backslash&&!u&&(u=!0,this.textNode+=t.substring(n,e-1),this.position+=e-1-n,s=t.charCodeAt(e++),this.position++,!s))break;if(u){if(u=!1,s===l.n?this.textNode+="\n":s===l.r?this.textNode+="\r":s===l.t?this.textNode+="\t":s===l.f?this.textNode+="\f":s===l.b?this.textNode+="\b":s===l.u?(p=1,this.unicodeS=""):this.textNode+=String.fromCharCode(s),s=t.charCodeAt(e++),this.position++,n=e-1,s)continue;break}d.lastIndex=e;var m=d.exec(t);if(null===m){e=t.length+1,this.textNode+=t.substring(n,e-1),this.position+=e-1-n;break}if(e=m.index+1,!(s=t.charCodeAt(m.index))){this.textNode+=t.substring(n,e-1),this.position+=e-1-n;break}}this.slashed=u,this.unicodeI=p;continue;case h.TRUE:s===l.r?this.state=h.TRUE2:S(this,"Invalid true started with t"+s);continue;case h.TRUE2:s===l.u?this.state=h.TRUE3:S(this,"Invalid true started with tr"+s);continue;case h.TRUE3:s===l.e?(f(this,"onvalue",!0),this.state=this.stack.pop()||h.VALUE):S(this,"Invalid true started with tru"+s);continue;case h.FALSE:s===l.a?this.state=h.FALSE2:S(this,"Invalid false started with f"+s);continue;case h.FALSE2:s===l.l?this.state=h.FALSE3:S(this,"Invalid false started with fa"+s);continue;case h.FALSE3:s===l.s?this.state=h.FALSE4:S(this,"Invalid false started with fal"+s);continue;case h.FALSE4:s===l.e?(f(this,"onvalue",!1),this.state=this.stack.pop()||h.VALUE):S(this,"Invalid false started with fals"+s);continue;case h.NULL:s===l.u?this.state=h.NULL2:S(this,"Invalid null started with n"+s);continue;case h.NULL2:s===l.l?this.state=h.NULL3:S(this,"Invalid null started with nu"+s);continue;case h.NULL3:s===l.l?(f(this,"onvalue",null),this.state=this.stack.pop()||h.VALUE):S(this,"Invalid null started with nul"+s);continue;case h.NUMBER_DECIMAL_POINT:s===l.period?(this.numberNode+=".",this.state=h.NUMBER_DIGIT):S(this,"Leading zero not followed by .");continue;case h.NUMBER_DIGIT:l._0<=s&&s<=l._9?this.numberNode+=String.fromCharCode(s):s===l.period?(-1!==this.numberNode.indexOf(".")&&S(this,"Invalid number has two dots"),this.numberNode+="."):s===l.e||s===l.E?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||S(this,"Invalid number has two exponential"),this.numberNode+="e"):s===l.plus||s===l.minus?(i!==l.e&&i!==l.E&&S(this,"Invalid symbol in number"),this.numberNode+=String.fromCharCode(s)):(N(this),e--,this.state=this.stack.pop()||h.VALUE);continue;default:S(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(t){const e=Math.max(o,10);let s=0;for(var i in a){var n=void 0===t[i]?0:t[i].length;if(n>e)switch(i){case"text":closeText(t);break;default:S(t,"Max buffer length exceeded: "+i)}s=Math.max(s,n)}t.bufferCheckPosition=o-s+t.position}(this),f(this,"onchunkparsed"),this}}function f(t,e,s){r&&console.log("-- emit",e,s),t[e]&&t[e](s,t)}function b(t,e,s){E(t),f(t,e,s)}function E(t,e){t.textNode=function(t,e){if(void 0===e)return e;t.trim&&(e=e.trim());t.normalize&&(e=e.replace(/\s+/g," "));return e}(t.options,t.textNode),void 0!==t.textNode&&f(t,e||"onvalue",t.textNode),t.textNode=void 0}function N(t){t.numberNode&&f(t,"onvalue",parseFloat(t.numberNode)),t.numberNode=""}function S(t,e){return E(t),e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c,e=new Error(e),t.error=e,f(t,"onerror",e),t}function y(t){return t===l.carriageReturn||t===l.lineFeed||t===l.space||t===l.tab}class m{constructor(){this.reset(),this._initializeParser()}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null})}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:e,key:s}=this.currentState;null!==s?(e[s]=t,this.currentState.key=null):e.push(t)}_openContainer(t){this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,key:null}}_closeContainer(){this.currentState=this.previousStates.pop()}_initializeParser(){this.parser=new p({onready:()=>{this.previousStates.length=0,this.currentState.container.length=0},onopenobject:t=>{this._openContainer({}),void 0!==t&&this.parser.onkey(t)},onkey:t=>{this.currentState.key=t},oncloseobject:()=>{this._closeContainer()},onopenarray:()=>{this._openContainer([])},onclosearray:()=>{this._closeContainer()},onvalue:t=>{this._pushOrSet(t)},onerror:t=>{throw t},onend:()=>{this.result=this.currentState.container.pop()}})}}class C extends m{constructor(){super(),this._extendParser()}write(t){super.write(t);let e=[];return this.topLevelArray&&(e=[...this.topLevelArray],this.topLevelArray.length=0),e}_extendParser(){this.parser.onopenarray=()=>{this.topLevelArray?this._openContainer([]):(this.topLevelArray=[],this._openContainer(this.topLevelArray))}}}const A={id:"json",name:"JSON",version:"2.0.2",extensions:["json"],mimeType:"text/json",category:"table",parse:async(t,e)=>_((new TextDecoder).decode(t),e),parseTextSync:_,parseInBatches:(t,e)=>(async function*(t,e){(e={...A.options,...e}).json={...A.options.json,...e.json};const{batchSize:s}=e.json,i=e.json.TableBatch;let o=!0,r=null,a=null;const h=new C;r=r||new n(i,a,s);for await(const e of t){const t=h.write(e);o&&(o=!1,a=L(t));for(const e of t)r.addRow(e),r.isFull()&&(yield r.getNormalizedBatch());r.chunkComplete(),r.isFull()&&(yield r.getNormalizedBatch())}const c=r.getNormalizedBatch();c&&(yield c)})(t,e),testText:null,text:!0,options:{json:{TableBatch:class{constructor(t,e){if(this.schema=t,this.batchSize=e,this.rows=null,this.length=0,this.isChunkComplete=!1,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}addRow(t){this.rows||(this.rows=new Array(this.batchSize),this.length=0),this.rows[this.length]=function(t,e){if(!t)throw new Error("null row");if(!Array.isArray(t))return t;if(!e)return t;const s={};for(let i=0;i<e.length;i++)s[e[i]]=t[i];return s}(t,this._headers),this.length++}chunkComplete(){this.isChunkComplete=!0}isFull(){return"auto"===this.batchSize?this.isChunkComplete&&this.length>0:this.rows&&this.length>=this.batchSize}getNormalizedBatch(){if(this.rows){const t=this.rows.slice(0,this.length);return this.rows=null,this.isChunkComplete=!1,{data:t,schema:this.schema,length:t.length}}return null}},batchSize:"auto"}}};function _(t,e){(e={...A.options,...e}).json={...A.options.json,...e.json};try{const s=JSON.parse(t);return e.json.table&&function t(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e)for(const s of Object.values(e)){const e=t(s);if(e)return e}return null}(s)||s}catch(t){throw new Error("JSONLoader: failed to parse JSON")}}function L(t){const e=t[0],s={};let i=0;for(const t in e){switch(typeof e[t]){case"number":case"boolean":s[t]={name:String(t),index:i,type:Float32Array};break;case"object":s[t]={name:String(t),index:i,type:Array};break;case"string":default:s[t]={name:String(t),index:i,type:Array}}i++}return s}s.d(e,"JSONLoader",(function(){return A})),s.d(e,"JSONParser",(function(){return m})),s.d(e,"StreamingJSONParser",(function(){return C})),s.d(e,"ClarinetParser",(function(){return p}))}])}));